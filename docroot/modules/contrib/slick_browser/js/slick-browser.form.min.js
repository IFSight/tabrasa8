!function(e,t){"use strict";function i(i,n){function o(t){if(t.preventDefault(),r(t.currentTarget),!y.length)return h.addClass("is-sb-collapsed"),!1;y.trigger("change.sbCounter"),e(".button-wrap--show-selection",n).show(),h.removeClass("is-sb-collapsed")}function a(i){var n=e(i),s=e('input[name^="entity_browser_select"]',i),o=s.val(),a=o.split(":"),r=a[1],l=e("img",i),d=e(".media",i).data("thumb"),c=e(".views-field--selection",i).length?e(".views-field--selection",i):e(".views-field:nth-child(2)",i),m=null;if(u.noLongerEmpty(),n.attr("data-entity-id",r).attr("data-entity",o),d?m=e('<img src="'+d+'" alt="'+t.t("Thumbnail")+'">'):l.length?m=l:c.length&&(m=c),null!==m&&y.length){m.clone().addClass("item-selected").detach().appendTo(y).wrapAll('<div class="item-container" data-entity-id="'+r+'" data-entity="'+o+'" />').once();e(".item-container",y).each(function(t){var i=e(this);e(".weight",i).length||(i.append('<span class="button-wrap button-wrap--remove"><input value="Remove" class="button button--remove button--remove-js" type="button"></span>'),i.append('<input class="weight" value="" type="hidden" />'),e(".button--remove",i).attr("data-entity-id",r).attr("data-entity",o).attr("data-remove-entity","items_"+o).attr("name","remove_"+r+"_"+t),e(".weight",i).val(t).attr("name","selected[items_"+r+"_"+t+"][weight]").attr("data-drupal-selector","edit-selected-items-"+r+"-"+t+"-weight"))}),s.prop("checked")||y.find('.item-container[data-entity-id="'+r+'"]').remove()}}function r(t){var i=e(t),n='input[name^="entity_browser_select"]',s=e(n,t),o=s.val(),r=o.split(":"),l=r[1],d=i.closest(".view--sb"),c=function(){s.prop("checked",!s.prop("checked")).attr("data-entity-id",l).attr("data-entity",o),i[s.prop("checked")?"addClass":"removeClass"]("is-marked is-checked"),e(".button--select",t).html(s.prop("checked")?"&#10003;":"&#43;")},m=function(){c(),a(t)};switch(C){case 1:if(d.find(".was-checked").length)return h.addClass("form--overlimit"),!1;h.removeClass("form--overlimit"),function(){e(n).not(i.find("input")).prop("checked",!1),d.find(".grid").not(this).removeClass("is-marked is-checked")}(),m(),y.length&&y.find('.item-container:not([data-entity-id="'+l+'"])').remove();break;case-1:m();break;default:var u=d.find(".is-marked").length;if(y.length&&y.children().length&&(u=y.children().length),h[u===C?"addClass":"removeClass"]("form--overlimit"),u>=C)return i.hasClass("is-checked")?(!function(){s.prop("checked",!1),i.removeClass("is-marked is-checked"),e(".button--select",t).html("&#43;"),y.length&&y.find('.item-container[data-entity-id="'+l+'"]').remove()}(),h.removeClass("form--overlimit")):h.addClass("form--overlimit"),!1;m()}}function l(t){t.preventDefault();var i=e(t.currentTarget),n=i.closest(".item-container"),s=n.data("entity"),o=h.find('input[name="entity_browser_select['+s+']"]'),a=h.find('.is-marked[data-entity="'+s+'"]');a.removeClass("is-marked is-checked"),o.prop("checked",!1).closest(".is-checked").removeClass("is-marked is-checked"),n.remove(),h.removeClass("form--overlimit"),e(".button--select",a).html("&#43;"),y.length&&y.trigger("change.sbCounter"),u.isEmpty()&&u.doEmpty()}function d(){h.toggleClass("is-sb-collapsed")}function c(){var t=e('<button id="edit-use-selected-clone" class="button button--primary button--sb button--use-selected-clone">'+k+"</button>"),i=b.eq(0).find(".ui-dialog-titlebar-close");v.length&&!b.find(w).length&&t.insertBefore(i),b.on("click.sbDialogInsert",w,function(t){e(t.delegateTarget).addClass("media--loading"),v.click()})}function m(t){e(t.target).remove()}var u=t.slickBrowser.form,h=e(n),f=h.closest("body"),g=e(window.parent.document),b=e(".ui-dialog:visible",g),p=e('input[name*="entity_browser_select"]',n),v=e('.button[name="use_selected"]',n),k=v.length?v.val():t.t("Add to Page"),w="#edit-use-selected-clone",y=e("#edit-selected",n).removeClass("hidden"),C=h.data("cardinality")||-1;u.$form=h,e(".sb__radios",n).length&&h.addClass("form--media-bundle-selection"),h.on("click.sbGrid",".grid:not(.view-list--header, .was-checked)",o),h.on("click.sbRemove",".button--remove-js",l),h.on("click.sbShow",".button--show-selection",d),h.on("click.sbUpload",".js-form-file, .dz-clickable",u.onUpload.bind(u)),h.on("click.sbInsert","#edit-use-selected",t.slickBrowser.loading),h.on("click.sbSubmit","#edit-submit",t.slickBrowser.loading),f.on("click.sbMessage",".messages",m),function(){if(window.clearTimeout(s),s=window.setTimeout(function(){e(".messages",f).remove()},6e3),f.addClass("sb-body"),e("> div:not(.sb__aside)",n).addClass("sb__main"),u.isEmpty())return u.doEmpty(),void(b.length&&b.find(w).remove());b.length&&c(),e(w).text(k).removeClass("visually-hidden"),p.length&&u.noLongerEmpty()}()}function n(i,n){var s=t.slickBrowser.form,o=e(n),a=o.closest("form"),r=a.data("targetType");s.$form=a,o.children().each(function(t,i){var n=e(i),a=n.data("entityId"),l=e("input",i),d=r+":"+a;s.toggleSelected(d,!1),l.on("mousedown",function(){s.toggleSelected(d,!0),window.setTimeout(function(){o.trigger("change.sbCounter")},300)})});var l=function(){s.toggleCounter()};l(),o.on("change.sbCounter",l)}var s;t.slickBrowser=t.slickBrowser||{},t.slickBrowser.form=t.slickBrowser.form||{$form:null,isEmpty:function(){return!e("#edit-selected",this.$form).children().length},doEmpty:function(){this.$form.addClass("is-sb-empty is-sb-collapsed")},noLongerEmpty:function(){this.$form.removeClass("is-sb-empty")},onUpload:function(){this.noLongerEmpty()},toggleCounter:function(){var i=this,n=i.$form.data("cardinality")||-1,s=e("#edit-selected",i.$form),o=e("#edit-counter",i.$form);if(s.length){var a=s.children().length,r=-1===n?"unlimited":n,l=t.formatPlural(a,"1","@count");l+=" "+t.formatPlural(r,"of 1 item selected","of @count items selected"),i.$form.hasClass("form--overlimit")?(l+=" "+t.t("(Remove one to select another)"),o.text(a>0?l:"")):o.text(a>0?l:""),i.isEmpty()&&i.doEmpty()}},toggleSelected:function(i,n){var s,o=e('input[name="entity_browser_select['+i+']"]'),a=n?"":t.t("Was selected");o.length&&(s=o.closest(".grid"),n?(o.prop("checked",!1).removeAttr("disabled"),s.removeClass("is-marked is-checked was-checked")):(o.prop("checked",!0).attr("disabled","disabled"),s.addClass("is-marked was-checked")),s.find("img").length?s.find("img").attr("title",a):s.attr("title",a))}},t.behaviors.slickBrowserForm={attach:function(t){e(".form--sb",t).once("sbForm").each(i),e(".entities-list",t).once("sbEntitiesList").each(n)},detach:function(t,i,n){"unload"===n&&e(".form--sb",t).removeOnce("sbForm").off(".sbGrid .sbInsert .sbRemove .sbShow .sbUpload")}}}(jQuery,Drupal);
