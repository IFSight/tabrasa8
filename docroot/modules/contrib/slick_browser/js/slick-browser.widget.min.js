!function(e,t,i){"use strict";function s(i,s){function a(){p&&(k.find(".slick-cloned").removeAttr("data-entity-id data-row-id data-drupal-selector"),k.on("setPosition",function(){k.find(".slick-cloned").removeAttr("data-entity-id data-row-id data-drupal-selector")}))}function l(){if(h.length){var e=h.height();b.height()-80<=e&&b.css("minHeight",e+80)}m.length&&f.length&&f[0].slick.refresh()}function r(i){i.preventDefault();var r=e(i.currentTarget),d=r.data("handled"),o=r.data("target"),c=b.siblings('input[type*=hidden][name*="[target_id]"]');"done"!==o&&b.data("deltas",""),b.toggleClass("is-sb-"+o),e.each(["caption","crop","sort","done"],function(e,t){"done"!==o&&o===t||b.removeClass("is-sb-"+t)}),e(".button--sb").removeClass("is-sb-active"),e(".button--"+o,s)[b.hasClass("is-sb-"+o)?"addClass":"removeClass"]("is-sb-active");var k=function(){var e=b.find("input[data-entity-id]").length;b.attr("data-sb-count-items",e)};switch(k(),o){case"crop":!d&&f.length&&f[0].slick.refresh();break;case"remove":var g=r.data("entityId")||r.closest("[data-entity-id]").data("entityId"),h=c.val(),m=b.data("removedId")||"";c.val(e.trim(h.replace(g,""))),b.data("removedId",m+" "+g),n(r),b.find('.sb__sortable [data-entity-id="'+g+'"]').remove(),k();break;case"removeall":c.val(""),b.contents(':not(div[id*="ajax-wrapper"])').remove(),b.css("minHeight",0),n(r),k();break;case"done":b.data("deltas")&&n(),f.length&&(e(".slick-prev:not(.slick-disabled)",f).length?e(".slick-prev:not(.slick-disabled)",f).trigger("click"):e(".slick-next:not(.slick-disabled)",f).length?e(".slick-next:not(.slick-disabled)",f).trigger("click"):f[0].slick.refresh()),k()}r.data("handled",!d),t.slickBrowser.jump(u),a(),l()}function n(i){e(".slick",s).length&&e(".slick",s).each(function(){var s=e(".slick__slider",this),a=e(".slide",s),l=s.slick("getSlick"),r=0,n=!1;if(i)if("removeall"===i.data("target"))s.slick("removeSlide",null,null,!0),n=!0;else{var d=i.closest(".slide").data("slickIndex");s.slick("slickRemove",d),a.each(function(){e(this).attr("data-slick-index",r),r++}),1===a.length&&(b.empty(),n=!0)}else a.sort(function(t,i){return e(t).data("rowId")-e(i).data("rowId")}),s.empty(),a.clone().detach().appendTo(s),s.slick(l.options),n=!0;n&&(t.attachBehaviors(b[0]),e(".media--player",a).length&&t.attachBehaviors(e(".media--player",a)[0]))})}function d(i){var s=e(i.delegateTarget),a=e(".is-sb-error",s).attr("id"),l=e(".sb .slick__slider",s),r=e(".form-text.required",l);r.length&&(e(".slick-cloned .form-text",l).removeAttr("required aria-required"),r.each(function(){var t=e(this);if(t.removeClass("error").removeAttr("tabindex"),!this.value){var i=parseInt(t.closest(".slide").data("slickIndex"));t.addClass("error"),t.closest(".sb--widget").addClass("is-sb-error is-sb-caption"),l.slick("slickGoTo",i,!0),l.slick("slickPause")}}),t.slickBrowser.jump(a))}function o(t){e(t.target).parent().addClass("is-focused")}function c(t){e(t.target).parent().removeClass("is-focused")}var b=e(s),u=b.attr("id"),k=e(".slick__slider",s),f=e(".slick--browser .slick__slider",s),g=e(".sb__header",s),h=e(".slick-dots",s),m=e(".sb__grid",s),v=b.data("end")?b.data("end"):0,p=f.hasClass("slick-initialized");e(".media-library-item--grid",s).removeClass("media-library-item--grid"),a(),b.hasClass("is-sb-1")&&e(".slick__slide",s).addClass("slick-current slick-active"),p&&!g.find(".slick__arrow").length&&f.siblings(".slick__arrow").appendTo(g),v>1&&e(".focal-point-indicator",f).length&&function(){e("*[draggable!=true]",f).unbind("dragstart"),f.on("draggable mouseenter mousedown",".focal-point-indicator",function(e){e.stopPropagation()})}(),b.data("deltas",""),b.off("click.btnSb").on("click.btnSb",".button--sb",r),b.off("click.altSb").on("click.altSb",".js-form-type-textfield input",o),b.off("blur.altSb").on("blur.altSb",".js-form-type-textfield input",c),e("form").on("click.btnDo",".publish .button",d),l()}function a(t,s){function a(t){var i,a=e(t.item),l=e(".sb__sortitem",s),r=a.closest(".sb--widget"),n=a.closest(".is-sb-eb").length,d=[],o=[],c=0,b=l.length;e(".slick",r).each(function(){var t=e(".slick__slider",this);t.hasClass("slick-initialized")&&t.slick("unslick")}),r.find(".slick__slide.slick-cloned").remove();for(var u=0;u<b;u++)i=l[u],c=e(i).data("rowId"),o[u]=c,e(".sb__weight",i).val(u),e(".sb__weight option",i).removeAttr("selected"),e('.sb__weight option[value="'+u+'"]',i).prop("selected",!0).siblings("option").prop("selected",!1),r.find(".slick__slide.slide--"+c).attr("data-slick-index",u).attr("data-row-id",u),e(i).attr("data-row-id",u),n&&(d[u]=e(i).attr("data-entity-id"));r.data("deltas",o),n&&r.siblings('input[type*=hidden][name*="[target_id]"]').val(d.join(" "))}i.create(s,{draggable:".sb__sortitem",onEnd:a})}t.behaviors.slickBrowserWidget={attach:function(i){e(".sb--widget",i).once("sbWidget").each(s),e(".sb__sortable",i).once("sbSortable").each(a),e(".js-form-managed-file .js-form-submit:not(.button--sb)",i).on("mousedown.sbAjax",t.slickBrowser.loading)},detach:function(i,s,a){"unload"===a&&(e(".js-form-managed-file .js-form-submit:not(.button--sb)",i).off(".sbAjax"),t.slickBrowser.loaded())}}}(jQuery,Drupal,Sortable);
